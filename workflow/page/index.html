
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Guidance</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="feather.css">
    <link rel="stylesheet" href="app.css">
 
    <style>
        body {
    
        }

        .option {
            padding: 8px;
            border: 1px solid;
            line-height: 22px;
        }

        .option:hover {
            text-decoration: underline;
            cursor: pointer;
        }

        .disabled, .disabled:hover {
            color: #999;
            cursor: not-allowed;
            text-decoration: none;
            opacity: .7;
        } 

        #json-log {
            font-size: 10px;
            max-height: 400px
        }

        .path-item {
            margin-right: 4px;
            font-size: 12px;
            padding: 0px 4px;
            line-height: 1.8;
        }

        .note {
            display: block;
            font-size: 13px;
            color: palevioletred;
            padding: 8px;
        }
    </style>

</head>
<body>
    
  
  

<div class="container mt-5">
    <div class="row">
        <div class="col-md-8 col-md-offset-2">
            <small id="path"></small>
            <h2 id="question-title" class="title"></h2>
            <p id="question-description"></p>
    
            <div id="options-wrapper"></div>

            <hr>

            <div id="note" class="well"></div>

            <pre id="json-log"></pre>
            <a href="" id="filename-log" target="_blank"></pre>
        </div>
    </div>
</div>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>


<script>
    const qTitle = document.getElementById('question-title');
    const qDesc = document.getElementById('question-description');
    const optsWrapper = document.getElementById('options-wrapper');
    const filenameLog = document.getElementById('filename-log');
    const jsonLog = document.getElementById('json-log');
    const path = document.getElementById('path');
    const note = document.getElementById('note');

    const dataUrl = "https://afalchi82.github.io/workflow/page/data/";
    const filesPath = "file:///C:\\Users\\Utente\\OneDrive - EDITIONS LEFEBVRE SARRUT\\Workflow\\redattore web ver 3-0";

    let history = [];


    /* ---------------------------------------------------
        Functions
    --------------------------------------------------- */

    function emptyEl (el) {
        while (el.firstChild) {
            el.removeChild(el.firstChild);
        }
    } 

    function resetStage () {                    
        [optsWrapper, filenameLog, path, note].forEach(el => emptyEl(el));
        
        qDesc.style.display = "block";
        note.style.display = "none";

        filenameLog.setAttribute('href', "");
    }

    function buildOption (optObj) {
        const wrapper = document.createElement("div");
        // wrapper.classList.add('col-md-6');
        wrapper.classList.add('mb-1');

        const opt = document.createElement("div");
        opt.innerText = optObj.label;
        opt.setAttribute('title', optObj.description || '');
        opt.classList.add('option');
        
        if (!optObj.child || optObj.disabled) {
            opt.classList.add('disabled');
        } else {
            opt.addEventListener("click", function () {
                loadData(optObj.child);
            });
        }


        wrapper.appendChild(opt);
        return wrapper;
    }

    function buildPathItem (id) {
        const step = document.createElement("button");
        step.innerText = id || "[id]";
        step.classList.add('path-item');
        step.addEventListener("click", function (ev) {
            loadData(id);
        });
        return step;
    }

    function buildStage (stageObj) {
        resetStage();

        if(stageObj.question) {
            qTitle.innerHTML = stageObj.question;
            stageObj.options.forEach(item => {
                optsWrapper.appendChild(buildOption(item));
            });
        } else {
            qTitle.innerHTML = "Risultato della ricerca";
        }

        stageObj.description ? qDesc.innerHTML = stageObj.description : qDesc.style.display = "none";

        updatePath(stageObj.id);

        // Debug
        jsonLog.innerHTML = JSON.stringify(stageObj, null, 2);
        if (stageObj._note) {
            note.innerHTML = stageObj._note;
            note.style.display = "block";
        }
        filenameLog.innerText = stageObj._filename + ".docx";
        filenameLog.setAttribute('href', filesPath + stageObj._filename + ".docx");

        
    }

    function loadData (id) {
        const url = dataUrl + id + ".json";
        $.ajax({
            cache: false,
            url,
            dataType: 'json',
            success( data ) {
                buildStage(data);
            },
            error( err ) {
                console.log(err)
                alert( "ERROR:  " + err.statusText );
            }
        });
    } 


    function updatePath (id) {
        emptyEl(path);

        const index = history.indexOf(id);
        if (index === -1) {
            history.push(id);
        } else {
            history = history.filter((el, i) => i <= index);
        }

        history.forEach(item => {
            path.appendChild(buildPathItem(item));
        });

    }


    /* ---------------------------------------------------
        Init
    --------------------------------------------------- */

    loadData("index");



</script>



</body>
</html>
